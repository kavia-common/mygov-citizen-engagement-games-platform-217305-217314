{"is_source_file": true, "format": "Python", "description": "This file initializes and configures a FastAPI web application for the MyGov Citizen Engagement Gaming Platform backend. It sets up the app, CORS middleware, database connection management, health check endpoints, and includes route modules for authentication, user management, games, leaderboard, analytics, and WebSocket services. It also provides an endpoint with instructions for WebSocket usage.", "external_files": ["src.api.routes.auth", "src.api.routes.users", "src.api.routes.games", "src.api.routes.leaderboard", "src.api.routes.analytics", "src.api.routes.ws", "db"], "external_methods": ["db_module.create_connection", "db_module.DatabaseConfigError"], "published": ["app", "health_check", "service_status", "websocket_help"], "classes": [{"name": "HealthResponse", "description": "Pydantic model for the health check response, including overall status, database connection status, and additional details."}], "methods": [{"name": "sqlite3.Connection get_db_conn()", "description": "Dependency to retrieve the current database connection, raising HTTP 503 error if the database is not initialized.", "scope": "", "scopeKind": ""}, {"name": "None on_startup()", "description": "Function called during application startup to initialize database connection.", "scope": "", "scopeKind": ""}, {"name": "None on_shutdown()", "description": "Function called during application shutdown to close the database connection.", "scope": "", "scopeKind": ""}, {"name": "HealthResponse health_check(db: sqlite3.Connection = Depends(get_db_conn))", "description": "API endpoint to perform a health check, verifying database connectivity and service status.", "scope": "", "scopeKind": ""}, {"name": "JSONResponse service_status()", "description": "API endpoint providing a lightweight, DB-independent status check.", "scope": "", "scopeKind": ""}, {"name": "PlainTextResponse websocket_help()", "description": "API endpoint providing instructions for WebSocket usage and connection details.", "scope": "", "scopeKind": ""}], "calls": ["db_module.create_connection", "db_module.DatabaseConfigError", "sqlite3.connect", "sqlite3.Error", "db.cursor", "cur.execute", "cur.fetchone", "HealthResponse", "HTTPException", "Depends", "JSONResponse", "PlainTextResponse"], "search-terms": ["FastAPI", "health check", "WebSocket instructions", "database connection", "API routes", "OpenAPI tags", "WebSocket WebSocket", "DB connection management"], "state": 2, "file_id": 2, "knowledge_revision": 35, "git_revision": "cbb06cc893df4cdf7cf89f7908442b0653e09500", "revision_history": [{"7": "e100e959f259d21122bf9eb25506196ece8c2bf0"}, {"12": "e100e959f259d21122bf9eb25506196ece8c2bf0"}, {"13": "e100e959f259d21122bf9eb25506196ece8c2bf0"}, {"14": "e100e959f259d21122bf9eb25506196ece8c2bf0"}, {"15": "57177fa216712bb08275bed0c7bf5c25bb0bad4a"}, {"22": "ead6510d46b957004c345f43de9c69c9c0a6d401"}, {"26": "cd0dc9336d4ce838a7bfb4872116d8553d791a9a"}, {"30": "f75e16e7266fa590076625344bedddd6abf005cf"}, {"35": "cbb06cc893df4cdf7cf89f7908442b0653e09500"}], "ctags": [{"_type": "tag", "name": "HealthResponse", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^class HealthResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_db_conn", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^_db_conn: Optional[sqlite3.Connection] = None$/", "language": "Python", "typeref": "typename:Optional[sqlite3.Connection]", "kind": "variable"}, {"_type": "tag", "name": "analytics_router", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^from src.api.routes.analytics import router as analytics_router  # noqa: E402$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "auth_router", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^from src.api.routes.auth import router as auth_router  # noqa: E402$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "database", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^    database: str = Field(..., description=\"Database connectivity status.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "HealthResponse", "scopeKind": "class"}, {"_type": "tag", "name": "db_module", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^from . import db as db_module$/", "language": "Python", "kind": "unknown", "nameref": "unknown:db"}, {"_type": "tag", "name": "detail", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^    detail: str = Field(..., description=\"Additional details about the service.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "HealthResponse", "scopeKind": "class"}, {"_type": "tag", "name": "games_router", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^from src.api.routes.games import router as games_router  # noqa: E402$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "get_db_conn", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^def get_db_conn() -> sqlite3.Connection:$/", "language": "Python", "typeref": "typename:sqlite3.Connection", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^def health_check(db: sqlite3.Connection = Depends(get_db_conn)) -> HealthResponse:$/", "language": "Python", "typeref": "typename:HealthResponse", "kind": "function", "signature": "(db: sqlite3.Connection = Depends(get_db_conn))"}, {"_type": "tag", "name": "leaderboard_router", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^from src.api.routes.leaderboard import router as leaderboard_router  # noqa: E402$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "on_shutdown", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^def on_shutdown() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "on_startup", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^def on_startup() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "service_status", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^def service_status() -> JSONResponse:$/", "language": "Python", "typeref": "typename:JSONResponse", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^    status: str = Field(..., description=\"Overall service status.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "HealthResponse", "scopeKind": "class"}, {"_type": "tag", "name": "users_router", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^from src.api.routes.users import router as users_router  # noqa: E402$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "websocket_help", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^def websocket_help() -> PlainTextResponse:$/", "language": "Python", "typeref": "typename:PlainTextResponse", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "ws_router", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/main.py", "pattern": "/^from src.api.routes.ws import router as ws_router  # noqa: E402$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}], "hash": "1746832bd82ab3b7d367cbd3bdb802c3", "format-version": 4, "code-base-name": "gaming_backend", "filename": "gaming_backend/src/api/main.py", "fields": [{"name": "Optional[sqlite3.Connection] _db_conn", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str database", "scope": "HealthResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str detail", "scope": "HealthResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str status", "scope": "HealthResponse", "scopeKind": "class", "description": "unavailable"}]}