{"is_source_file": true, "format": "Python", "description": "This file defines a WebSocket route for real-time leaderboard updates, including connection management, broadcasting updates, and handling client connections via FastAPI.", "external_files": ["fastapi", "pydantic", "asyncio"], "external_methods": ["fastapi.APIRouter", "fastapi.WebSocket", "fastapi.WebSocketDisconnect", "pydantic.BaseModel", "pydantic.Field"], "published": ["notify_leaderboard_update"], "classes": [{"name": "LeaderboardBroadcast", "description": "Models the payload structure for leaderboard update messages sent to WebSocket clients."}], "methods": [{"name": "None _register_connection(ws: WebSocket, game_id: int | None)", "description": "Registers a WebSocket connection, either globally or scoped to a specific game.", "scope": "", "scopeKind": ""}, {"name": "None _unregister_connection(ws: WebSocket, game_id: int | None)", "description": "Unregisters a WebSocket connection from the registries.", "scope": "", "scopeKind": ""}, {"name": "bool _safe_send(ws: WebSocket, data: str)", "description": "Attempts to send a message over WebSocket, returns False if the socket is closed or broken.", "scope": "", "scopeKind": ""}, {"name": "None notify_leaderboard_update(game_id: int, update: Dict[str, Any])", "description": "Broadcasts a leaderboard update message to all relevant WebSocket clients.", "scope": "", "scopeKind": ""}, {"name": "None leaderboard_ws(websocket: WebSocket)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["websocket.accept()", "websocket.query_params.get()", "websocket.receive_text()", "websocket.send_text()", "LeaderboardBroadcast.model_dump_json()", "_safe_send(ws, payload_str)"], "search-terms": ["WebSocket", "leaderboard", "FastAPI WebSocket route", "connection registry", "leaderboard_update broadcast"], "state": 2, "file_id": 12, "knowledge_revision": 36, "git_revision": "cbb06cc893df4cdf7cf89f7908442b0653e09500", "revision_history": [{"33": ""}, {"36": "cbb06cc893df4cdf7cf89f7908442b0653e09500"}], "ctags": [{"_type": "tag", "name": "LeaderboardBroadcast", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^class LeaderboardBroadcast(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_all_connections", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^_all_connections: Set[WebSocket] = set()$/", "language": "Python", "typeref": "typename:Set[WebSocket]", "kind": "variable"}, {"_type": "tag", "name": "_connections_by_game", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^_connections_by_game: Dict[int, Set[WebSocket]] = {}$/", "language": "Python", "typeref": "typename:Dict[int, Set[WebSocket]]", "kind": "variable"}, {"_type": "tag", "name": "_register_connection", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^async def _register_connection(ws: WebSocket, game_id: int | None) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(ws: WebSocket, game_id: int | None)"}, {"_type": "tag", "name": "_registry_lock", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^_registry_lock = asyncio.Lock()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_safe_send", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^async def _safe_send(ws: WebSocket, data: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(ws: WebSocket, data: str)"}, {"_type": "tag", "name": "_unregister_connection", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^async def _unregister_connection(ws: WebSocket, game_id: int | None) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(ws: WebSocket, game_id: int | None)"}, {"_type": "tag", "name": "event", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^    event: str = Field(..., description=\"Event type identifier, e.g., 'leaderboard_update'\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "LeaderboardBroadcast", "scopeKind": "class"}, {"_type": "tag", "name": "game_id", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^    game_id: int = Field(..., description=\"Game ID for which the update applies\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "LeaderboardBroadcast", "scopeKind": "class"}, {"_type": "tag", "name": "leaderboard_ws", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^async def leaderboard_ws(websocket: WebSocket) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(websocket: WebSocket)"}, {"_type": "tag", "name": "notify_leaderboard_update", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^async def notify_leaderboard_update(game_id: int, update: Dict[str, Any]) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(game_id: int, update: Dict[str, Any])"}, {"_type": "tag", "name": "payload", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^    payload: Dict[str, Any] = Field($/", "language": "Python", "typeref": "typename:Dict[str, Any]", "kind": "variable", "scope": "LeaderboardBroadcast", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^router = APIRouter(prefix=\"\\/ws\", tags=[\"WebSocket\"])$/", "language": "Python", "kind": "variable"}], "hash": "99111667717e54a93e54455572ff97e2", "format-version": 4, "code-base-name": "gaming_backend", "filename": "gaming_backend/src/api/routes/ws.py", "fields": [{"name": "Set[WebSocket] _all_connections", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[int, Set[WebSocket]] _connections_by_game", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_registry_lock = asyncio.Lock()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str event", "scope": "LeaderboardBroadcast", "scopeKind": "class", "description": "unavailable"}, {"name": "int game_id", "scope": "LeaderboardBroadcast", "scopeKind": "class", "description": "unavailable"}, {"name": "Dict[str, Any] payload", "scope": "LeaderboardBroadcast", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/ws\", tags=[\"WebSocket\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}