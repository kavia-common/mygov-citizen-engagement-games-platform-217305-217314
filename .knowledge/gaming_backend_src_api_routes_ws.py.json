{"is_source_file": true, "format": "Python", "description": "This Python source file defines a WebSocket API endpoint for real-time leaderboard updates, including connection management, broadcasting, and subscription filtering based on game ID. It uses FastAPI, asyncio, and Pydantic for data handling.", "external_files": ["fastapi", "pydantic", "asyncio", "json"], "external_methods": ["FastAPI.APIRouter", "FastAPI.WebSocket", "FastAPI.WebSocketDisconnect", "pydantic.BaseModel", "pydantic.Field"], "published": ["notify_leaderboard_update"], "classes": [{"name": "LeaderboardBroadcast", "description": "Data model for broadcasting leaderboard updates, including event type, game ID, and payload."}], "methods": [{"name": "None _register_connection(ws: WebSocket, game_id: int | None)", "description": "Registers a WebSocket connection globally or for a specific game ID.", "scope": "", "scopeKind": ""}, {"name": "None _unregister_connection(ws: WebSocket, game_id: int | None)", "description": "Removes a WebSocket connection from the registry, optionally scoped to a game.", "scope": "", "scopeKind": ""}, {"name": "bool _safe_send(ws: WebSocket, data: str)", "description": "Attempts to send a message over WebSocket; returns False if send fails.", "scope": "", "scopeKind": ""}, {"name": "None notify_leaderboard_update(game_id: int, update: Dict[str, Any])", "description": "Broadcasts a leaderboard update message to all relevant WebSocket clients.", "scope": "", "scopeKind": ""}, {"name": "None leaderboard_ws(websocket: WebSocket)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["notify_leaderboard_update", "websocket.accept", "websocket.receive_text", "websocket.send_text", "_register_connection", "_unregister_connection", "_safe_send"], "search-terms": ["WebSocket leaderboard", "FastAPI WebSocket route", "leaderboard broadcast", "connection registry", "game-specific WebSocket"], "state": 2, "file_id": 12, "knowledge_revision": 33, "git_revision": "", "ctags": [{"_type": "tag", "name": "LeaderboardBroadcast", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^class LeaderboardBroadcast(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_all_connections", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^_all_connections: Set[WebSocket] = set()$/", "language": "Python", "typeref": "typename:Set[WebSocket]", "kind": "variable"}, {"_type": "tag", "name": "_connections_by_game", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^_connections_by_game: Dict[int, Set[WebSocket]] = {}$/", "language": "Python", "typeref": "typename:Dict[int, Set[WebSocket]]", "kind": "variable"}, {"_type": "tag", "name": "_register_connection", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^async def _register_connection(ws: WebSocket, game_id: int | None) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(ws: WebSocket, game_id: int | None)"}, {"_type": "tag", "name": "_registry_lock", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^_registry_lock = asyncio.Lock()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_safe_send", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^async def _safe_send(ws: WebSocket, data: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(ws: WebSocket, data: str)"}, {"_type": "tag", "name": "_unregister_connection", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^async def _unregister_connection(ws: WebSocket, game_id: int | None) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(ws: WebSocket, game_id: int | None)"}, {"_type": "tag", "name": "event", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^    event: str = Field(..., description=\"Event type identifier, e.g., 'leaderboard_update'\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "LeaderboardBroadcast", "scopeKind": "class"}, {"_type": "tag", "name": "game_id", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^    game_id: int = Field(..., description=\"Game ID for which the update applies\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "LeaderboardBroadcast", "scopeKind": "class"}, {"_type": "tag", "name": "leaderboard_ws", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^async def leaderboard_ws(websocket: WebSocket) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(websocket: WebSocket)"}, {"_type": "tag", "name": "notify_leaderboard_update", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^async def notify_leaderboard_update(game_id: int, update: Dict[str, Any]) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(game_id: int, update: Dict[str, Any])"}, {"_type": "tag", "name": "payload", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^    payload: Dict[str, Any] = Field($/", "language": "Python", "typeref": "typename:Dict[str, Any]", "kind": "variable", "scope": "LeaderboardBroadcast", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/ws.py", "pattern": "/^router = APIRouter(prefix=\"\\/ws\", tags=[\"WebSocket\"])$/", "language": "Python", "kind": "variable"}], "hash": "5863eeecbf1e4a3a5849a41f98110de4", "format-version": 4, "code-base-name": "gaming_backend", "filename": "gaming_backend/src/api/routes/ws.py", "fields": [{"name": "Set[WebSocket] _all_connections", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[int, Set[WebSocket]] _connections_by_game", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_registry_lock = asyncio.Lock()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str event", "scope": "LeaderboardBroadcast", "scopeKind": "class", "description": "unavailable"}, {"name": "int game_id", "scope": "LeaderboardBroadcast", "scopeKind": "class", "description": "unavailable"}, {"name": "Dict[str, Any] payload", "scope": "LeaderboardBroadcast", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/ws\", tags=[\"WebSocket\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"33": ""}]}