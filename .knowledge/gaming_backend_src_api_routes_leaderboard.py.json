{"is_source_file": true, "format": "Python", "description": "This file defines API routes for a leaderboard system in a gaming platform, including endpoints for retrieving the top leaderboard and a user's leaderboard details, with database interaction and data models.", "external_files": ["src.api.main", "<module>", "get_db_conn"], "external_methods": ["get_db_conn"], "published": ["router"], "classes": [{"name": "LeaderboardEntry", "description": "Represents an entry in the leaderboard with user ID, score, timestamp, and rank."}, {"name": "LeaderboardPage", "description": "Represents a page of leaderboard entries including total size, limit, offset, and items."}, {"name": "UserLeaderboardResponse", "description": "Response model for a user's best score and rank in a game."}], "methods": [{"name": "tuple[int,int] _validate_pagination(limit: int, offset: int)", "description": "Validates and adjusts pagination parameters to within allowed bounds.", "scope": "", "scopeKind": ""}, {"name": "None _ensure_scores_indexes(conn: sqlite3.Connection)", "description": "Ensures database indexes are created to optimize leaderboard queries.", "scope": "", "scopeKind": ""}, {"name": "bool _game_exists(conn: sqlite3.Connection, game_id: int)", "description": "Checks if a game exists in the database.", "scope": "", "scopeKind": ""}, {"name": "LeaderboardPage get_top_leaderboard( game_id: int = Query(..., ge=1, description=\"Game ID\"), limit: int = Query(10, ge=1, le=100, description=\"Maximum rows to return\"), offset: int = Query(0, ge=0, description=\"Offset for pagination\"), db: sqlite3.Connection = Depends(get_db_conn), )", "description": "API endpoint that retrieves a paginated list of the top scores for a given game.", "scope": "", "scopeKind": ""}, {"name": "UserLeaderboardResponse get_user_leaderboard_entry( user_id: int, game_id: int = Query(..., ge=1, description=\"Game ID\"), db: sqlite3.Connection = Depends(get_db_conn), )", "description": "API endpoint that retrieves a specific user's best score and rank in a game.", "scope": "", "scopeKind": ""}], "calls": ["get_db_conn", "cur.execute", "cur.fetchone", "cur.fetchall", "conn.commit"], "search-terms": ["leaderboard", "FastAPI", "sqlite3", "scores", "game_id", "user_id", "pagination", "ranking", "best_score", "Top Leaderboard", "User Leaderboard"], "state": 2, "file_id": 10, "knowledge_revision": 28, "git_revision": "", "ctags": [{"_type": "tag", "name": "LeaderboardEntry", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^class LeaderboardEntry(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "LeaderboardPage", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^class LeaderboardPage(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "UserLeaderboardResponse", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^class UserLeaderboardResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_ensure_scores_indexes", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^def _ensure_scores_indexes(conn: sqlite3.Connection) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(conn: sqlite3.Connection)"}, {"_type": "tag", "name": "_game_exists", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^def _game_exists(conn: sqlite3.Connection, game_id: int) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(conn: sqlite3.Connection, game_id: int)"}, {"_type": "tag", "name": "_validate_pagination", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^def _validate_pagination(limit: int, offset: int) -> tuple[int, int]:$/", "language": "Python", "typeref": "typename:tuple[int,int]", "kind": "function", "signature": "(limit: int, offset: int)"}, {"_type": "tag", "name": "best_at", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    best_at: Optional[str] = Field(None, description=\"Timestamp for best score\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "UserLeaderboardResponse", "scopeKind": "class"}, {"_type": "tag", "name": "best_at", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    best_at: Optional[str] = Field(None, description=\"When the best score was recorded\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "LeaderboardEntry", "scopeKind": "class"}, {"_type": "tag", "name": "best_score", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    best_score: Optional[int] = Field(None, description=\"User best score or None if no scores\")$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "UserLeaderboardResponse", "scopeKind": "class"}, {"_type": "tag", "name": "best_score", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    best_score: int = Field(..., description=\"User's best score for the game\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "LeaderboardEntry", "scopeKind": "class"}, {"_type": "tag", "name": "game_id", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    game_id: int = Field(..., description=\"Game ID\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "LeaderboardPage", "scopeKind": "class"}, {"_type": "tag", "name": "game_id", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    game_id: int = Field(..., description=\"Game ID\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "UserLeaderboardResponse", "scopeKind": "class"}, {"_type": "tag", "name": "get_top_leaderboard", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^def get_top_leaderboard($/", "language": "Python", "typeref": "typename:LeaderboardPage", "kind": "function", "signature": "( game_id: int = Query(..., ge=1, description=\"Game ID\"), limit: int = Query(10, ge=1, le=100, description=\"Maximum rows to return\"), offset: int = Query(0, ge=0, description=\"Offset for pagination\"), db: sqlite3.Connection = Depends(get_db_conn), )"}, {"_type": "tag", "name": "get_user_leaderboard_entry", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^def get_user_leaderboard_entry($/", "language": "Python", "typeref": "typename:UserLeaderboardResponse", "kind": "function", "signature": "( user_id: int, game_id: int = Query(..., ge=1, description=\"Game ID\"), db: sqlite3.Connection = Depends(get_db_conn), )"}, {"_type": "tag", "name": "items", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    items: List[LeaderboardEntry] = Field(..., description=\"Leaderboard entries\")$/", "language": "Python", "typeref": "typename:List[LeaderboardEntry]", "kind": "variable", "scope": "LeaderboardPage", "scopeKind": "class"}, {"_type": "tag", "name": "limit", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    limit: int = Field(..., description=\"Page size limit used\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "LeaderboardPage", "scopeKind": "class"}, {"_type": "tag", "name": "offset", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    offset: int = Field(..., description=\"Offset used for pagination\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "LeaderboardPage", "scopeKind": "class"}, {"_type": "tag", "name": "rank", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    rank: Optional[int] = Field($/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "UserLeaderboardResponse", "scopeKind": "class"}, {"_type": "tag", "name": "ranks", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    ranks: Optional[int] = Field(None, description=\"Rank (1-based) when available\")$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "LeaderboardEntry", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^router = APIRouter(prefix=\"\\/leaderboard\", tags=[\"Leaderboard\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "total_users", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    total_users: int = Field(..., description=\"Total number of users on the leaderboard\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "LeaderboardPage", "scopeKind": "class"}, {"_type": "tag", "name": "user_id", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    user_id: int = Field(..., description=\"Requested user ID\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "UserLeaderboardResponse", "scopeKind": "class"}, {"_type": "tag", "name": "user_id", "path": "/home/kavia/workspace/code-generation/mygov-citizen-engagement-games-platform-217305-217314/gaming_backend/src/api/routes/leaderboard.py", "pattern": "/^    user_id: int = Field(..., description=\"User ID\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "LeaderboardEntry", "scopeKind": "class"}], "hash": "81dc6b01aac301abeff4f22a327dbb62", "format-version": 4, "code-base-name": "gaming_backend", "filename": "gaming_backend/src/api/routes/leaderboard.py", "fields": [{"name": "Optional[str] best_at", "scope": "UserLeaderboardResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] best_score", "scope": "UserLeaderboardResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "int best_score", "scope": "LeaderboardEntry", "scopeKind": "class", "description": "unavailable"}, {"name": "int game_id", "scope": "LeaderboardPage", "scopeKind": "class", "description": "unavailable"}, {"name": "List[LeaderboardEntry] items", "scope": "LeaderboardPage", "scopeKind": "class", "description": "unavailable"}, {"name": "int limit", "scope": "LeaderboardPage", "scopeKind": "class", "description": "unavailable"}, {"name": "int offset", "scope": "LeaderboardPage", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] rank", "scope": "UserLeaderboardResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] ranks", "scope": "LeaderboardEntry", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/leaderboard\", tags=[\"Leaderboard\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "int total_users", "scope": "LeaderboardPage", "scopeKind": "class", "description": "unavailable"}, {"name": "int user_id", "scope": "UserLeaderboardResponse", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"28": ""}]}